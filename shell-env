#!/bin/sh
# shellcheck disable=1091,2089,2090

# print kwin/QT debug output to journal
# export QT_LOGGING_RULES="kwin_*.debug=true"

export PATH="${HOME}/.local/bin:${HOME}/.cargo/bin:${PATH}"
export TMPDIR="${TMPDIR:-/tmp}"

# =============== XDG base directories =========== {{{
export XDG_CONFIG_HOME="${HOME}/.config"
export XDG_CACHE_HOME="${HOME}/.cache"
export XDG_STATE_HOME="${HOME}/.local/state"
export XDG_DATA_HOME="${HOME}/.local/share"
#}}}

# =============== EDITOR/VISUAL ================== {{{
export EDITOR=vi
if [ -x "$(command -v vim)" ]; then
	MANPAGER="vim '+MANPAGER' --not-a-term -c 'setlocal ts=8 ft=man nomod nolist nonu' -c 'nmap q :q!' -"
	EDITOR=vim
fi
if [ -x "$(command -v nvim)" ]; then
	MANPAGER="nvim '+Man!' -c 'nmap q :q!'"
	EDITOR=nvim
fi
if [ -x "$(command -v nvim)" ] && [ -x "$(command -v lvim)" ]; then
	EDITOR=lvim
fi
export VISUAL="${EDITOR}"
[ -n "${MANPAGER}" ] && export MANPAGER
#}}}

# =============== kitty shell integration ======== {{{
kitty_shell_integration() {
	if [ ! -x "$(command -v kitty)" ] \
		|| [ ! -x "$(command -v git)" ] \
		|| [ ! "xterm-kitty" = "${TERM}" ]; then
		return 1
	fi

	export KITTY_SHELL_DATA_DIR="${XDG_DATA_HOME:-$HOME/.local/share}/kitty/shell-integration"

	if [ -d "${KITTY_SHELL_DATA_DIR}/bash" ] && [ -d "${KITTY_SHELL_DATA_DIR}/zsh" ]; then
		return
	fi

	echo "Installing kitty's shell integration files"

	kitty_dir=$(mktemp -d)
	mkdir -p "${KITTY_SHELL_DATA_DIR}"
	git clone --depth=1 'https://github.com/kovidgoyal/kitty' "${kitty_dir}"
	mv "${kitty_dir}/shell-integration/"* "${KITTY_SHELL_DATA_DIR}"
	rm -rf "${kitty_dir}"
}
kitty_shell_integration
#}}}

# =============== NPM setup (javascript) ========= {{{
# Install new npm packages globally *for the user* so it won't need `sudo'
npm_directory="${XDG_DATA_HOME}/npm-global"
mkdir -p "${npm_directory}"
export NPM_CONFIG_PREFIX="${npm_directory}"
export PATH="${PATH}:${npm_directory}"
#}}}

# =============== anaconda setup (python) ======== {{{
# snippet generated by 'conda init'
__conda_setup=$("${HOME}/anaconda3/bin/conda" 'shell.bash' 'hook' 2> /dev/null)
# shellcheck disable=2181
if [ $? -eq 0 ]; then
	eval "$__conda_setup"
else
	if [ -f "${HOME}/anaconda3/etc/profile.d/conda.sh" ]; then
		. "${HOME}/anaconda3/etc/profile.d/conda.sh"
	else
		export PATH="${HOME}/anaconda3/bin:$PATH"
	fi
fi
unset __conda_setup
#}}}

# vim:fdm=marker:fdl=0:
